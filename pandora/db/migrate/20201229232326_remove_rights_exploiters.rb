class RemoveRightsExploiters < ActiveRecord::Migration[5.2]
  def up
    change_table :institutions do |t|
      t.boolean :can_exploit_rights
    end

    connection.select_all('select * from rights_exploiters').each do |r|
      institution = Institution.find(r['institution_id'])
      institution.update_attributes(
        email: r['email'].strip,
        can_exploit_rights: true
      )
    end

    drop_table :rights_exploiters
  end

  def down
    raise ActiveRecord::IrreversibleMigration
  end
end
